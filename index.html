<!doctype html>
<html>
  <head>
    <title>Peter's Page</title>
    <script type="text/javascript">
    
    document.addEventListener("DOMContentLoaded", init, false);
    document.addEventListener("mousemove", checkBorder, false);
    
    var mouseDown = false;
    
    function init()
    {
        var canvas = document.getElementById("canvas");
        canvas.addEventListener("mousemove", draw, false);
        canvas.addEventListener("mousedown", function(){mouseDown=true;}, false);
        canvas.addEventListener("mouseup", function(){mouseDown=false;}, false);
        
        var colCan;
        var colCtx;
        var ccols = [["cred", "red"], ["cgreen", "green"],
                     ["cblue", "blue"], ["corange", "orange"]];
        for(var i in ccols){
            colCan = document.getElementById(ccols[i][0]);
            colCtx = colCan.getContext("2d");
            colCtx.fillStyle = ccols[i][1];
            ctx.fillRect(0, 0, colCan.width, colCan.height);
        }
    }
    
    function checkBorder(e)
    {
        var canvas = document.getElementById("canvas");
        var x = e.x - canvas.offsetLeft;
        var y = e.y - canvas.offsetTop;
        if (x >= 700 || y >= 700 || x <= 0 || y <= 0)
            mouseDown = false;
    }
    
   function draw(e)
   {
   
        if (!mouseDown)
            return;
            
        var canvas = document.getElementById("canvas");   
        var ctx = canvas.getContext("2d");
        var x = e.x - this.offsetLeft - 350;
        var y = e.y - this.offsetTop - 350;
        
        var absx = Math.abs(x);
        var absy = Math.abs(y);
        var dis = Math.sqrt(Math.pow(absx,2)+Math.pow(absy,2));
        
        var ang = Math.atan(y/x);
        
        sqrs(350, 350, ctx, dis, "black", ang);

        function sqrCallback(col)
        {
            return function(){
                sqrs(350, 350, ctx, dis, col, ang);
            }
        }
        
        setTimeout(sqrCallback("orange"), 1000);
        setTimeout(sqrCallback("red"), 2000);
       
        setTimeout(sqrCallback("white"), 3000);
        
        /*
        circs(350, 350, ctx, dis, "black");
        
        function circCallback(col)
        {
            return function(){
                circs(350, 350, ctx, dis, col);
            }
        }
        
        setTimeout(circCallback("orange"), 1000);
        setTimeout(circCallback("red"), 2000);
        setTimeout(circCallback("white"), 3000);
        */
        
        /* Silly thing for doing all the colors!
        // 255/17 = 15. That's useful!
        // 17^3 = 4913
        for (var i = 0; i < 4913; i++)
        {
            var r = 15*Math.floor(i/289); 
            var g = 15*Math.floor((i-(r*289/15))/17);
            var b = 15*Math.floor(i%17);
            var ccol = "rgb(" + r.toString() + "," + g.toString() + "," +
                       b.toString() + ")";
            setTimeout(circCallback(ccol), i);
        }
        */
    
   }
   
   function circs(x, y, ctx, sze, col)
   {
        if (sze < 20) 
            return;
        var nsze = Math.floor(sze);
        ctx.beginPath();
        ctx.moveTo(x+nsze, y);
        ctx.arc(x, y, nsze, 0, 2*Math.PI);
        ctx.strokeStyle = col;
        ctx.stroke();
        circs(x+nsze, y, ctx, nsze/2);
        circs(x-nsze, y, ctx, nsze/2);
        circs(x, y+nsze, ctx, nsze/2);
        circs(x, y-nsze, ctx, nsze/2);
   }
   
   function myMod(x, n)
   {
        var nx = x;
        while(nx < 0)
            nx = nx + n;
        while(nx >= n)
            nx = nx - n;
        return nx;
   }
   
   function sqrs(x, y, ctx, dis, col, rot)
   {
        if (dis < 5)
            return;
       
        var rads = myMod(rot, Math.PI/2);
        var cx = new Array();
        var cy = new Array();
        for (var i = 0; i < 4; i++){
            cx[i] = x + dis*Math.cos(rads+(i*Math.PI/2));
            cy[i] = y + dis*Math.sin(rads+(i*Math.PI/2));
        }
        if (col == "white")
            ctx.lineWidth = 3;
        else ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(cx[3], cy[3]);
        for (var i = 0; i < 4; i++)
            ctx.lineTo(cx[i], cy[i]);
        ctx.strokeStyle = col;
        ctx.stroke();
        
        for (var i = 0; i < 4; i++)
            sqrs(cx[i], cy[i], ctx, dis/3, col, rot+Math.PI/4);
        
   }
   
   function clearScn()
   {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
       
        ctx.save();
        ctx.setTransform(1, 0 , 0, 1, 0, 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
        
   }
 
    </script>
    <style type="text/css">
    canvas {border: 1px solid black; }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="700" height="700"></canvas>
    <canvas id="cred" width="50" height="50"></canvas>
    <canvas id="cgreen" width="50" height="50"></canvas>
    <canvas id="cblue" width="50" height="50"></canvas>
    <canvas id="corange" width="50" height="50"></canvas>
    <button type="button" onclick="clearScn()">Clear</button>
    <p>Site Under Construction</p>
  </body>
</html>