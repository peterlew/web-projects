<!doctype html>
<html>
  <head>
    <title>Peter's Page</title>
    <script type="text/javascript">
    
    document.addEventListener("DOMContentLoaded", init, false);
    document.addEventListener("mousemove", checkBorder, false);
    document.addEventListener("mouseup", mUp, false);    
    
    var mouseDown = 0;
    
    //keep an even number of colors please!
    var ccols = ["red", "green", "blue", "orange"];    
    
    function init()
    {
        var canvas = document.getElementById("canvas");
        canvas.addEventListener("mousemove", draw, false);
        canvas.addEventListener("mousedown", function(){mouseDown=1;}, false);
        
        var colSel = document.getElementById("colSelect");
        var selCtx = colSel.getContext("2d");
        
        drawColBoxes(colSel, selCtx, -1);
        
        colSel.addEventListener("mousedown", colSelected, false);
        colSel.addEventListener("mousemove", moveSelected, false);
        
    }
    
    function mUp()
    {
        mouseDown = 0;
        var canv = document.getElementById("colSelect");
        drawColBoxes(canv, canv.getContext("2d"), -1);
    }
    
    function drawColBoxes(canv, ctx, noDraw)
    {
        
        ctx.clearRect(0, 0, canv.width, canv.height);
        
        var th, tw;
        
        for(var i in ccols){
            if(i == noDraw)
                continue;
            th = (Math.floor(i/2)) * 50;
            tw = (i % 2) * 50;
            ctx.fillStyle = ccols[i];
            ctx.fillRect((11*tw/10) + 95, (11*th/10) + 200, 50, 50);
        }
      
    }
    
    function inColGap(x, y)
    {
        if(x <= 95 || x >= 200 || y <= 200) // on the left, right or top
            return true;
        if(x >= 145 && x <= 150) // in the middle gap
            return true;
        if(y >= 200 + 55*(ccols.length/2)) // off the bottom
            return true;
        var checkY = y;
        while(checkY >= 255)
            checkY -= 55;
        if(checkY >= 250) // in a row gap
            return true;
        return false;
    }
    
    function colSelected(e)
    {
        
        mouseDown = 2;
        
        var canvas = document.getElementById("colSelect");
        var ctx = canvas.getContext("2d");
        var x = e.x - canvas.offsetLeft;
        var y = e.y - canvas.offsetTop;

        document.getElementById("bottomText").innerHTML = x.toString() + " " + y.toString();
     
        if(inColGap(x, y))
            return;
        
        var colnum;
        if(x <= 95 + 50 + 2)
            colnum = 0;
        else colnum = 1;
        var rownum;
        rownum = Math.floor((y - 200)/55);
        
        var colIndex = 2*rownum + colnum;
        
        document.getElementById("bottomText").innerHTML = colIndex.toString();
        
        var boxX = (11*((colIndex % 2) * 50)/10) + 95;
        var boxY = (11*(Math.floor(colIndex/2) * 50)/10) + 200;
        
        var desX = x - 25;
        var desY = y - 25;
        
        drawColBoxes(canvas, ctx, colIndex);
        ctx.fillStyle = ccols[colIndex];
        ctx.fillRect(desX, desY, 50, 50);
        
        /* Animation -- not really working
        while(boxX != desX || boxY != desY)
        {
            drawColBoxes(canvas, ctx, colIndex);
            ctx.fillStyle = ccols[colIndex];
            ctx.fillRect(boxX, boxY, 50, 50);
            if(boxX < desX)
                boxX++;
            else if(boxX > dexX)
                boxX--;
            if(boxY < desY)
                boxY++;
            else if(boxY > desY)
                boxY--;
        }
        */
        
    }
    
    function checkBorder(e)
    {
        if (mouseDown == 0) 
            return;
        if (mouseDown == 1)
            var canvas = document.getElementById("canvas");
        else if (mouseDown == 2)
            var canvas = document.getElementById("colSelect");
        else return;
        
        var x = e.x - canvas.offsetLeft;
        var y = e.y - canvas.offsetTop;
        if (x >= canvas.width || y >= canvas.height || x <= 0 || y <= 0)
        {
            if(mouseDown == 2)
                drawColBoxes(canvas, canvas.getContext("2d"), -1);
            mouseDown = 0;
        }    
    }
    
   function draw(e)
   {
   
        if (mouseDown != 1)
            return;
            
        var canvas = document.getElementById("canvas");   
        var ctx = canvas.getContext("2d");
        var x = e.x - this.offsetLeft - 350;
        var y = e.y - this.offsetTop - 350;
        
        var absx = Math.abs(x);
        var absy = Math.abs(y);
        var dis = Math.sqrt(Math.pow(absx,2)+Math.pow(absy,2));
        
        var ang = Math.atan(y/x);
        
        sqrs(350, 350, ctx, dis, "black", ang);

        function sqrCallback(col)
        {
            return function(){
                sqrs(350, 350, ctx, dis, col, ang);
            }
        }
        
        setTimeout(sqrCallback("orange"), 1000);
        setTimeout(sqrCallback("red"), 2000);
       
        setTimeout(sqrCallback("white"), 3000);
        
        /*
        circs(350, 350, ctx, dis, "black");
        
        function circCallback(col)
        {
            return function(){
                circs(350, 350, ctx, dis, col);
            }
        }
        
        setTimeout(circCallback("orange"), 1000);
        setTimeout(circCallback("red"), 2000);
        setTimeout(circCallback("white"), 3000);
        */
        
        /* Silly thing for doing all the colors!
        // 255/17 = 15. That's useful!
        // 17^3 = 4913
        for (var i = 0; i < 4913; i++)
        {
            var r = 15*Math.floor(i/289); 
            var g = 15*Math.floor((i-(r*289/15))/17);
            var b = 15*Math.floor(i%17);
            var ccol = "rgb(" + r.toString() + "," + g.toString() + "," +
                       b.toString() + ")";
            setTimeout(circCallback(ccol), i);
        }
        */
    
   }
   
   function circs(x, y, ctx, sze, col)
   {
        if (sze < 20) 
            return;
        var nsze = Math.floor(sze);
        ctx.beginPath();
        ctx.moveTo(x+nsze, y);
        ctx.arc(x, y, nsze, 0, 2*Math.PI);
        ctx.strokeStyle = col;
        ctx.stroke();
        circs(x+nsze, y, ctx, nsze/2);
        circs(x-nsze, y, ctx, nsze/2);
        circs(x, y+nsze, ctx, nsze/2);
        circs(x, y-nsze, ctx, nsze/2);
   }
   
   function myMod(x, n)
   {
        var nx = x;
        while(nx < 0)
            nx = nx + n;
        while(nx >= n)
            nx = nx - n;
        return nx;
   }
   
   function sqrs(x, y, ctx, dis, col, rot)
   {
        if (dis < 5)
            return;
       
        var rads = myMod(rot, Math.PI/2);
        var cx = new Array();
        var cy = new Array();
        for (var i = 0; i < 4; i++){
            cx[i] = x + dis*Math.cos(rads+(i*Math.PI/2));
            cy[i] = y + dis*Math.sin(rads+(i*Math.PI/2));
        }
        if (col == "white")
            ctx.lineWidth = 3;
        else ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(cx[3], cy[3]);
        for (var i = 0; i < 4; i++)
            ctx.lineTo(cx[i], cy[i]);
        ctx.strokeStyle = col;
        ctx.stroke();
        
        for (var i = 0; i < 4; i++)
            sqrs(cx[i], cy[i], ctx, dis/3, col, rot+Math.PI/4);
        
   }
   
   function clearScn()
   {
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
       
        ctx.save();
        ctx.setTransform(1, 0 , 0, 1, 0, 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
        
   }
 
    </script>
    <style type="text/css">
    #canvas {border: 1px solid black; }
    #colSelect {}
    </style>
  </head>
  <body>
    <canvas id="canvas" width="700" height="700"></canvas>
    <canvas id="colSelect" width="225" height="700"></canvas> 
    <p><button type="button" onclick="clearScn()">Clear</button></p>
    <p id="bottomText">Site Under Construction</p>
  </body>
</html>